<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>AI Detector Alarm Dashboard</title>

    <!-- CSS íŒŒì¼ë“¤ -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/simplePagination.js/1.6/simplePagination.css"
    />
    <link rel="stylesheet" href="/static/css/fault_dashboard.css" />
    <link rel="stylesheet" href="/static/css/fault_dashboard_equip.css" />
    <link rel="stylesheet" href="/static/css/map_tooltip.css" />

    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,500;1,500&display=swap"
      rel="stylesheet"
    />

    <!-- D3.js ë¨¼ì € ë¡œë“œ (ë™ê¸°) -->
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <!-- jQuery ë¡œë“œ (ë™ê¸°) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/simplePagination.js/1.6/jquery.simplePagination.min.js"></script>

    <!-- AI Detector ëª¨ë“ˆ -->
    <script type="module">
      console.log('ğŸš€ AI Detector ëª¨ë“ˆ ì‹œìŠ¤í…œ ì‹œì‘...');

      // ëª¨ë“ˆ ë¡œë”©
      async function initializeSystemSafely() {
        try {
          const dashboardContainer = document.getElementById('dashboard');
          if (dashboardContainer) {
            dashboardContainer.classList.add('loading');
          }

          console.log('ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ FaultDashboardApp ë¡œë”©...');
          const { faultDashboardApp } = await import('/static/js/core/FaultDashboardApp.js');

          // ì´ˆê¸°í™” ì „ ëŒ€ì‹œë³´ë“œ ìƒíƒœ ì¤€ë¹„
          if (dashboardContainer) {
            dashboardContainer.classList.remove('loading');
          }
          // ì´ˆê¸°í™”
          await faultDashboardApp.initialize();

          console.log('âœ… ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ FaultDashboardApp ì´ˆê¸°í™” ì™„ë£Œ');
        } catch (error) {
          const loadingOverlay = document.getElementById('loading-overlay');
          if (loadingOverlay) {
            loadingOverlay.classList.add('fade-out');
            setTimeout(() => {
              loadingOverlay.remove();
            }, 500);
          }

          console.error('âŒ ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ FaultDashboardApp ì´ˆê¸°í™” ì‹¤íŒ¨:', error);

          // ìƒì„¸ ì˜¤ë¥˜ ì •ë³´
          console.error('ì˜¤ë¥˜ ìƒì„¸:', {
            message: error.message,
            stack: error.stack,
            name: error.name,
          });

          // ì‚¬ìš©ì ì•Œë¦¼
          alert(`ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨: ${error.message}\n\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.`);
        }
      }

      // DOM ë¡œë“œ í›„ ì´ˆê¸°í™”
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeSystemSafely);
      } else {
        initializeSystemSafely();
      }
    </script>
  </head>
  <body>
    <!-- ìƒë‹¨ í—¤ë” ì˜ì—­ -->
    <div class="top-header">
      <div class="header-left">
        <button id="hamburger-btn" class="hamburger-btn">
          <span></span>
          <span></span>
          <span></span>
        </button>
        <div class="header-title" onclick="location.reload();" style="cursor: pointer">
          AI Detector
        </div>
      </div>

      <div class="header-right">
        <!-- ì „ì²´ í˜„í™© ìš”ì•½ ë¼ì¸ -->
        <div class="header-summary">
          <span>ì‹¤ì‹œê°„ ê²½ë³´ì¥ë¹„</span><span id="realtime-alarm-equip-count">0 ëŒ€</span>
          <span>| &nbsp;ì „ì²´ ê²½ë³´</span><span id="total-alarm-count">0 ê±´</span>
          <span>| &nbsp;ìµœê·¼ ê²½ë³´</span><span id="recent-alarm-update-time"> -</span>

          <!-- ìš°ìƒë‹¨ì— ì¥ë¹„/êµ­ì‚¬ ê¸°ì¤€ ë©”ë‰´ -->
          <span class="summary-title">| &nbsp;MAP ìœ í˜•</span>
          <button id="equip-view-btn" class="view-btn active">ì¥ë¹„ ì—°ê²° ê¸°ì¤€</button>
          <button id="guksa-view-btn" class="view-btn">ë™ì¼ êµ­ì‚¬ ê¸°ì¤€</button>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="left-sidebar">
        <div>
          <div style="display: flex; justify-content: space-between; align-items: center">
            <span class="default-title">ëŒ€ìƒ êµ­ì‚¬ </span>
            <span style="cursor: pointer; font-size: 10pt" onclick="location.reload();"
              >Refresh âŸ³</span
            >
          </div>
          <div>
            <select id="searchGuksa">
              <option value="">ì „ì²´ êµ­ì‚¬</option>
            </select>
          </div>
        </div>

        <div>
          <label class="default-title">ê²½ë³´ë°œìƒ ì‹œê°„</label>
          <select id="timeFilter">
            <option value="10">ìµœê·¼ 5ë¶„</option>
            <option value="10">ìµœê·¼ 10ë¶„</option>
            <option value="15">ìµœê·¼ 15ë¶„</option>
            <option value="20">ìµœê·¼ 20ë¶„</option>
            <option value="30" selected>ìµœê·¼ 30ë¶„</option>
            <option value="60">ìµœê·¼ 1ì‹œê°„</option>
            <option value="120">ìµœê·¼ 2ì‹œê°„</option>
            <option value="180">ìµœê·¼ 3ì‹œê°„</option>
            <option value="360">ìµœê·¼ 6ì‹œê°„</option>
          </select>
        </div>

        <div>
          <label class="default-title">ê²½ë³´ë°œìƒ ì¥ë¹„ ì„ íƒ</label>
          <div class="radio-group" id="searchNWType">
            <label><input type="radio" name="sector" value="MW" /> MW</label>
            <label><input type="radio" name="sector" value="ì„ ë¡œ" /> ì„ ë¡œ</label>
            <label><input type="radio" name="sector" value="ì „ì†¡" /> ì „ì†¡</label>
            <label><input type="radio" name="sector" value="IP" checked /> IP</label>
            <label><input type="radio" name="sector" value="ë¬´ì„ " /> ë¬´ì„ </label>
            <label><input type="radio" name="sector" value="êµí™˜" /> êµí™˜</label>
          </div>
        </div>

        <div>
          <!-- ê²½ë³´ë°œìƒ ì¥ë¹„ ê²€ìƒ‰ í•„í„° -->
          <div class="equip-filter-container">
            <input
              type="text"
              id="equipFilterInput"
              class="equip-filter-input"
              placeholder="ğŸ” ì¥ë¹„ëª… ê²€ìƒ‰..."
            />
            <div class="equip-filter-div">
              <button id="equipFilterBtn" class="filter-btn">Filter</button>
              <button id="equipResetBtn" class="filter-btn">Reset</button>
            </div>
          </div>

          <!-- ê²½ë³´ë°œìƒ ì¥ë¹„ ëª©ë¡ -->
          <div>
            <select id="searchEquipName" class="equip-select" size="15" tabindex="0"></select>
          </div>
        </div>
        <br /><br />
        <button id="fault-point-btn" class="fault-view-btn">ì¥ì• ì  ì°¾ê¸°</button>
      </div>

      <!-- right-content ì˜ì—­ -->
      <div class="right-content">
        <div class="top-dashboard">
          <div
            id="dashboard"
            class="draggable-container loading"
            style="display: flex; flex-direction: row; flex-wrap: nowrap; overflow-x: auto"
          ></div>
        </div>

        <!-- ë§µ-ì±„íŒ… ë¶„í•  ì˜ì—­ -->
        <div class="horizontal-split-area">
          <!-- ì¢Œì¸¡: ë§µ ì˜ì—­ -->
          <div class="left-map-panel">
            <div class="new-map-container" id="map-container">
              <!-- ë§µ ë¡œë”© ìŠ¤í”¼ë„ˆ -->
              <div id="map-loading-spinner" class="map-loading-spinner" style="display: none">
                <div class="map-spinner">
                  <div class="spinner-ring"></div>
                  <div class="spinner-text">í† í´ë¡œì§€ ë¡œë”© ì¤‘...</div>
                </div>
              </div>

              <!-- ì—¬ê¸°ì— d3.js ë§µì´ ì¶”ê°€ë  ì˜ˆì • -->
            </div>
          </div>

          <!-- ìš°ì¸¡: ì±„íŒ… ê²°ê³¼ ì˜ì—­ -->
          <div class="right-chat-panel">
            <div class="chat-messages-container" id="chat-messages-area" tabindex="0">
              <div class="chat-message system">
                <div class="message-content">
                  ğŸ’¡ ì¥ì• ì  ì°¾ê¸°ë¥¼ í´ë¦­í•˜ë©´ AI ë¶„ì„ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.
                </div>
                <div class="message-time">00:00</div>
              </div>
            </div>
            <div class="chat-input-container">
              <input type="text" id="chat-input" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." />
              <button id="chat-send-btn">ì „ì†¡</button>
            </div>
          </div>
        </div>

        <!-- í…Œì´ë¸” ì˜ì—­ (ê¸°ì¡´ ìœ ì§€) -->
        <div class="bottom-div">
          <div class="table-container" tabindex="0">
            <table id="alarmTable" class="alarm-table">
              <thead>
                <tr>
                  <th>| êµ­ì‚¬</th>
                  <th>| ë¶„ì•¼</th>
                  <th>| ìœ íš¨/ë¬´íš¨</th>
                  <th>| ë°œìƒì‹œê°„</th>
                  <th>| ì¥ë¹„ID</th>
                  <th>| ì¥ë¹„ìœ í˜•</th>
                  <th>| ì¥ë¹„ëª…</th>
                  <th>| ê²½ë³´ë‚´ìš©</th>
                </tr>
              </thead>
              <tbody id="alarmTableBody"></tbody>
            </table>
          </div>
          <!-- <div id="pagination"></div> -->
        </div>
      </div>
    </div>

    <!-- ê¸°ë³¸ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • -->
    <script>
      // ì˜¤ë¥˜ ì¶”ì  ë° ë””ë²„ê¹…
      window.addEventListener('error', function (e) {
        console.error('ğŸš¨ ì „ì—­ ì˜¤ë¥˜ ê°ì§€:', {
          message: e.message,
          filename: e.filename,
          lineno: e.lineno,
          colno: e.colno,
          error: e.error,
        });
      });

      window.addEventListener('unhandledrejection', function (e) {
        console.error('ğŸš¨ ì²˜ë¦¬ë˜ì§€ ì•Šì€ Promise ê±°ë¶€:', e.reason);
      });

      console.log('ğŸ“‹ ê¸°ë³¸ ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ');
    </script>
  </body>
</html>
